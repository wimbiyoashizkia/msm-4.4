# SPECTRUM KERNEL MANAGER
# Ramdisk file for profile based kernel management
# Implimentation inspired by Franco's fku profiles

# Initialization
on property:sys.boot_completed=1
   # Set default profile on first boot
   exec u:r:init:s0 root root -- /vendor/etc/init/hw/init.spectrum.sh
   exec u:r:su:s0 root root -- /vendor/etc/init/hw/init.spectrum.sh
   # Enable Spectrum support
   setprop spectrum.support 1
   # Add kernel name
   setprop persist.spectrum.kernel NEON

# Balance
on property:persist.spectrum.profile=0
    # CPU Little Cluster
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor schedutil
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 20000
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_tolerance 20
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/efficient_freq "1536000 1612800"
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_delay 100
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 500
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 633600

    # CPU Big Cluster
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor schedutil
    write /sys/devices/system/cpu/cpu4/cpufreq/schedutil/down_rate_limit_us 20000
    write /sys/devices/system/cpu/cpu4/cpufreq/schedutil/down_tolerance 20
    write /sys/devices/system/cpu/cpu4/cpufreq/schedutil/efficient_freq "1401600 1804800"
    write /sys/devices/system/cpu/cpu4/cpufreq/schedutil/up_delay 100
    write /sys/devices/system/cpu/cpu4/cpufreq/schedutil/up_rate_limit_us 500
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 1113600

    # CPU Boost
    write /sys/devices/system/cpu/cpu_boost/dynamic_stune_boost 0
    write /sys/devices/system/cpu/cpu_boost/dynamic_stune_boost_ms 40
    write /sys/devices/system/cpu/cpu_boost/input_boost_enabled 1 
    write /sys/devices/system/cpu/cpu_boost/input_boost_freq "0:0 1:0 2:0 3:0 4:0 5:0 6:0 7:0"
    write /sys/devices/system/cpu/cpu_boost/input_boost_ms 40

    # GPU
    write /sys/class/kgsl/kgsl-3d0/min_clock_mhz 160
    write /sys/class/kgsl/kgsl-3d0/max_clock_mhz 430

    # Devfreq
    write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost 0

    # I/O Scheduler
    write /sys/block/mmcblk0/queue/scheduler "bfq"
    write /sys/block/mmcblk0/queue/add_random 1
    write /sys/block/mmcblk0/queue/iostats 0
    write /sys/block/mmcblk0/queue/read_ahead_kb 128
    write /sys/block/mmcblk0/queue/nr_requests 512

    # Stune Assist
    write /dev/stune/top-app/schedtune.prefer_idle 1
    write /dev/stune/top-app/schedtune.boost 0

    # Scheduler
    write /proc/sys/kernel/perf_cpu_time_max_percent 5
    write /proc/sys/kernel/sched_autogroup_enabled 1
    write /proc/sys/kernel/sched_child_runs_first 0
    write /proc/sys/kernel/sched_tunable_scaling 0
    write /proc/sys/kernel/sched_latency_ns 10000000
    write /proc/sys/kernel/sched_min_granularity_ns 1250000
    write /proc/sys/kernel/sched_wakeup_granularity_ns 5000000
    write /proc/sys/kernel/sched_migration_cost_ns 0
    write /proc/sys/kernel/sched_nr_migrate 8

    # FSync
    write /sys/module/sync/parameters/fsync_enabled 1

    # Virtual Memory
    write /proc/sys/vm/dirty_background_ratio 10
    write /proc/sys/vm/dirty_ratio 80
    write /proc/sys/vm/dirty_writeback_centisecs 500
    write /proc/sys/vm/dirty_expire_centisecs 3000
    write /proc/sys/vm/stat_interval 20
    write /proc/sys/vm/swappiness 60
    write /proc/sys/vm/vfs_cache_pressure 100

    # TCP
    write /proc/sys/net/ipv4/tcp_ecn 1
    write /proc/sys/net/ipv4/tcp_fastopen 1
    write /proc/sys/net/ipv4/tcp_syncookies 0

# Performance
on property:persist.spectrum.profile=1
    # CPU Little Cluster
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor schedutil
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 0
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_tolerance 20
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/efficient_freq 1612800
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_delay 100
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 0
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 633600

    # CPU Big Cluster
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor energy-dcfc
    write /sys/devices/system/cpu/cpu4/cpufreq/energy-dcfc/down_rate_limit_us 0
    write /sys/devices/system/cpu/cpu4/cpufreq/energy-dcfc/load1_cap 1113600
    write /sys/devices/system/cpu/cpu4/cpufreq/energy-dcfc/load1_cap 1401600
    write /sys/devices/system/cpu/cpu4/cpufreq/energy-dcfc/target_load1 15
    write /sys/devices/system/cpu/cpu4/cpufreq/energy-dcfc/target_load1 50
    write /sys/devices/system/cpu/cpu4/cpufreq/energy-dcfc/up_rate_limit_us 0
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 1113600

    # GPU
    write /sys/class/kgsl/kgsl-3d0/min_clock_mhz 266
    write /sys/class/kgsl/kgsl-3d0/max_clock_mhz 430

    # Devfreq
    write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost 1

    # I/O Scheduler
    write /sys/block/mmcblk0/queue/scheduler "noop"
    write /sys/block/mmcblk0/queue/add_random 0
    write /sys/block/mmcblk0/queue/iostats 0
    write /sys/block/mmcblk0/queue/read_ahead_kb 32
    write /sys/block/mmcblk0/queue/nr_requests 32

    # Stune Assist
    write /dev/stune/top-app/schedtune.prefer_idle 1
    write /dev/stune/top-app/schedtune.boost 1

    # Scheduler
    write /proc/sys/kernel/perf_cpu_time_max_percent 3
    write /proc/sys/kernel/sched_autogroup_enabled 1
    write /proc/sys/kernel/sched_child_runs_first 1
    write /proc/sys/kernel/sched_tunable_scaling 0
    write /proc/sys/kernel/sched_latency_ns 1000000
    write /proc/sys/kernel/sched_min_granularity_ns 100000
    write /proc/sys/kernel/sched_wakeup_granularity_ns 500000
    write /proc/sys/kernel/sched_migration_cost_ns 5000000
    write /proc/sys/kernel/sched_nr_migrate 4

    # FSync
    write /sys/module/sync/parameters/fsync_enabled 0

    # Virtual Memory
    write /proc/sys/vm/dirty_background_ratio 3
    write /proc/sys/vm/dirty_ratio 30
    write /proc/sys/vm/dirty_writeback_centisecs 3000
    write /proc/sys/vm/dirty_expire_centisecs 3000
    write /proc/sys/vm/stat_interval 10
    write /proc/sys/vm/swappiness 100
    write /proc/sys/vm/vfs_cache_pressure 200

    # TCP
    write /proc/sys/net/ipv4/tcp_ecn 1
    write /proc/sys/net/ipv4/tcp_fastopen 3
    write /proc/sys/net/ipv4/tcp_syncookies 0

# Battery
on property:persist.spectrum.profile=2
    # CPU Little Cluster
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "schedutil"
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 5000
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_tolerance 20
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/efficient_freq 1113600
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_delay 1000
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 5000
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 300000

    # CPU Big Cluster
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor "smurfutil"
    write /sys/devices/system/cpu/cpu4/cpufreq/smurfutil/bif_shift1 2
    write /sys/devices/system/cpu/cpu4/cpufreq/smurfutil/bif_shift1_2 2
    write /sys/devices/system/cpu/cpu4/cpufreq/smurfutil/bif_shift2 10
    write /sys/devices/system/cpu/cpu4/cpufreq/smurfutil/down_rate_limit_us 5000
    write /sys/devices/system/cpu/cpu4/cpufreq/smurfutil/gold_suspend_max_freq 1113600
    write /sys/devices/system/cpu/cpu4/cpufreq/smurfutil/iowait_boost_enable 0
    write /sys/devices/system/cpu/cpu4/cpufreq/smurfutil/silver_suspend_max_freq 633600
    write /sys/devices/system/cpu/cpu4/cpufreq/smurfutil/silver_capacity_factor 10
    write /sys/devices/system/cpu/cpu4/cpufreq/smurfutil/target_load1 10
    write /sys/devices/system/cpu/cpu4/cpufreq/smurfutil/target_load2 75
    write /sys/devices/system/cpu/cpu4/cpufreq/smurfutil/up_rate_limit_us 5000
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 300000

    # CPU Boost
    write /sys/devices/system/cpu/cpu_boost/dynamic_stune_boost 0
    write /sys/devices/system/cpu/cpu_boost/dynamic_stune_boost_ms 40
    write /sys/devices/system/cpu/cpu_boost/input_boost_enabled 0
    write /sys/devices/system/cpu/cpu_boost/input_boost_freq "0:0 1:0 2:0 3:0 4:0 5:0 6:0 7:0"
    write /sys/devices/system/cpu/cpu_boost/input_boost_ms 40

    # GPU
    write /sys/class/kgsl/kgsl-3d0/min_clock_mhz 160
    write /sys/class/kgsl/kgsl-3d0/max_clock_mhz 430

    # Devfreq
    write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost 0

    # I/O Scheduler
    write /sys/block/mmcblk0/queue/scheduler "noop"
    write /sys/block/mmcblk0/queue/add_random 0
    write /sys/block/mmcblk0/queue/iostats 0
    write /sys/block/mmcblk0/queue/read_ahead_kb 64
    write /sys/block/mmcblk0/queue/nr_requests 512

    # Stune Assist
    write /dev/stune/top-app/schedtune.prefer_idle 0
    write /dev/stune/top-app/schedtune.boost 0

    # Scheduler
    write /proc/sys/kernel/perf_cpu_time_max_percent 2
    write /proc/sys/kernel/sched_autogroup_enabled 1
    write /proc/sys/kernel/sched_child_runs_first 0
    write /proc/sys/kernel/sched_tunable_scaling 0
    write /proc/sys/kernel/sched_latency_ns 5000000
    write /proc/sys/kernel/sched_min_granularity_ns 1000000
    write /proc/sys/kernel/sched_wakeup_granularity_ns 2500000
    write /proc/sys/kernel/sched_migration_cost_ns 5000000
    write /proc/sys/kernel/sched_nr_migrate 256

    # FSync
    write /sys/module/sync/parameters/fsync_enabled 1

    # Virtual Memory
    write /proc/sys/vm/dirty_background_ratio 2
    write /proc/sys/vm/dirty_ratio 5
    write /proc/sys/vm/dirty_writeback_centisecs 500
    write /proc/sys/vm/dirty_expire_centisecs 500
    write /proc/sys/vm/stat_interval 10
    write /proc/sys/vm/swappiness 100
    write /proc/sys/vm/vfs_cache_pressure 100

    # TCP
    write /proc/sys/net/ipv4/tcp_ecn 1
    write /proc/sys/net/ipv4/tcp_fastopen 3
    write /proc/sys/net/ipv4/tcp_syncookies 0

# Gaming
on property:persist.spectrum.profile=3
    # CPU Little Cluster
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor schedutil
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 40000
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_tolerance 20
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/efficient_freq 1612800
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_delay 50
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 10000
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 633600

    # CPU Big Cluster
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor schedutil
    write /sys/devices/system/cpu/cpu4/cpufreq/schedutil/down_rate_limit_us 40000
    write /sys/devices/system/cpu/cpu4/cpufreq/schedutil/down_tolerance 20
    write /sys/devices/system/cpu/cpu4/cpufreq/schedutil/efficient_freq 1804800
    write /sys/devices/system/cpu/cpu4/cpufreq/schedutil/up_delay 50
    write /sys/devices/system/cpu/cpu4/cpufreq/schedutil/up_rate_limit_us 10000
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 1113600

    # GPU
    write /sys/class/kgsl/kgsl-3d0/min_clock_mhz 370
    write /sys/class/kgsl/kgsl-3d0/max_clock_mhz 430

    # Devfreq
    write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost 2

    # I/O Scheduler
    write /sys/block/mmcblk0/queue/scheduler "cfq"
    write /sys/block/mmcblk0/queue/add_random 0
    write /sys/block/mmcblk0/queue/iostats 0
    write /sys/block/mmcblk0/queue/read_ahead_kb 512
    write /sys/block/mmcblk0/queue/nr_requests 512

    # Stune Assist
    write /dev/stune/top-app/schedtune.prefer_idle 0
    write /dev/stune/top-app/schedtune.boost 1

    # Scheduler
    write /proc/sys/kernel/perf_cpu_time_max_percent 20
    write /proc/sys/kernel/sched_autogroup_enabled 0
    write /proc/sys/kernel/sched_child_runs_first 0
    write /proc/sys/kernel/sched_tunable_scaling 0
    write /proc/sys/kernel/sched_latency_ns 10000000
    write /proc/sys/kernel/sched_min_granularity_ns 1666666
    write /proc/sys/kernel/sched_wakeup_granularity_ns 5000000
    write /proc/sys/kernel/sched_migration_cost_ns 5000000
    write /proc/sys/kernel/sched_nr_migrate 128

    # FSync
    write /sys/module/sync/parameters/fsync_enabled 0

    # Virtual Memory
    write /proc/sys/vm/dirty_background_ratio 15
    write /proc/sys/vm/dirty_ratio 30
    write /proc/sys/vm/dirty_writeback_centisecs 3000
    write /proc/sys/vm/dirty_expire_centisecs 3000
    write /proc/sys/vm/stat_interval 10
    write /proc/sys/vm/swappiness 100
    write /proc/sys/vm/vfs_cache_pressure 80

    # TCP
    write /proc/sys/net/ipv4/tcp_ecn 1
    write /proc/sys/net/ipv4/tcp_fastopen 3
    write /proc/sys/net/ipv4/tcp_syncookies 0